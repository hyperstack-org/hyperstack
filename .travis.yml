language: bash
cache:
  bundler: true
  directories:
  - node_modules # NPM packages
addons:
  apt:
    sources:
      - sourceline: 'deb http://dl.yarnpkg.com/debian/ stable main'
        key_url: 'http://dl.yarnpkg.com/debian/pubkey.gpg'
      - sourceline: 'deb http://dl.google.com/linux/chrome/deb/ stable main'
        key_url: 'https://dl-ssl.google.com/linux/linux_signing_key.pub'
    packages:
      - google-chrome-stable
      - yarn
env:
  - COMPONENT=hyper-component LANGUAGE=ruby LANGUAGE_VERSION=2.5.1
matrix:
    fast_finish: true
before_install:
  # yarn is in /usr/local/bin/yarn version 1.3.2 and is not a package
  # must remove this zombie for new yarn to work
  - sudo rm -f /usr/local/bin/yarn
  - gem install bundler
  - nvm install 10
  - rvm install $LANGUAGE_VERSION
before_script:
  - cd $LANGUAGE/$COMPONENT
  - bundle install --jobs=3 --retry=3
  - yarn install
  - bundle exec rake spec:prepare
script:
  - bundle exec rake
